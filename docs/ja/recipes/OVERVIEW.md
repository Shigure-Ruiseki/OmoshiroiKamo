# レシピシステム概要 (Recipe System Overview)

OmoshiroiKamo のモジュラーレシピシステムは、従来の 1.7.10 のレシピシステムの枠を超えた、複雑で多様なリソースを扱うクラフトを処理するために構築されています。

## 1. コアコンセプト

- **リソースの抽象化**: レシピは `ItemStack` のような特定の Minecraft オブジェクトに依存しません。代わりに `IRecipeInput` と `IRecipeOutput` を使用します。これらは、アイテム、液体、エネルギー、マナ、またはカスタム NBT データなど、あらゆるものを表すことができます。
- **Builder パターン**: `ModularRecipe` インスタンスは `Builder` を介して作成されます。これにより、時間、優先度、複数の入出力など、数十のオプションパラメータがあっても、コードの可読性と型安全性が維持されます。
- **レシピグループ**: すべてのレシピは「グループ」（例：`ore_miner`, `crusher`）に属します。マシンは特定のグループ内のレシピを呼び出すため、異なるマシン間でレシピセットを共有したり、独自に持たせたりすることが可能です。

## 2. 処理フロー

1. **照合 (Match)**: マシン内の `ProcessAgent` が、そのグループに属するすべてのレシピを取得します。
2. **入力チェック**: 各レシピがマシンのポートを確認し、要件（アイテム、エネルギーなど）が満たされているか判断します。
3. **条件チェック**: 追加の `ICondition`（例：雨が降っている必要がある、ネザーにいる必要がある）が評価されます。
4. **実行**: 照合に成功し、マシンが起動すると、エンジンは入力を消費し、設定された `duration`（時間）の経過後に出力を生成します。

## 3. 非結合アーキテクチャ

レシピエンジン自体は、エネルギーや液体をどのように消費するかを知りません。エンジンは `IRecipeInput` の実装に対し、特定の `IModularPort` リストに対して自身を「処理」するように依頼します。この分離（デカップリング）により、新しいエネルギーシステム（IC2 の EU や Botania のマナなど）のサポートを、新しい `IRecipeInput` タイプを追加するだけで簡単に実現できます。
