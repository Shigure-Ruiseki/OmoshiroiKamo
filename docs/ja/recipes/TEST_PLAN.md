# レシピシステム: テスト計画

このドキュメントでは、モジュラーレシピシステムのテスト戦略について説明します。

## 1. 主要なテスト領域

### 1.1 整合性と論理
- **照合 (Matching)**: レポート設定に対してレシピが正しく判定されるかの確認。
- **処理 (Processing)**: 入力の消費と出力の生成（シミュレーション vs 実際）。
- **優先度**: 同一グループ内での重複レシピの優先順位処理。

### 1.2 リソース処理 (I/O)
- **アイテム**: スタックサイズ順守と NBT の保持。
- **液体**: タンク容量と部分的な排出・注入ロジック。
- **エネルギー**: RF/EU バッファの処理。
- **カスタム**: ガス、マナ、エッセンシアのレジストリ処理。

### 1.3 Decorator と Condition
- **Decorator**: ボーナスや効率ブーストのためのラップされたロジック。
- **Condition**: 環境チェック（天候、ディメンション、時間）。

## 2. 実装状況
レシピシステムは現在、堅牢なテストスイートを備えています。新しい統合（DML や Chickens など）を追加する場合は、ここに特定の統合テストを追加する必要があります。

## 3. ベストプラクティス
- **確率テスト**: 確率ベースの出力については、1000 回の試行による統計的チェックを使用して検証してください。
- **コンテキストのモック**: 環境に依存するテストでは、モックされた `ConditionContext` を使用してください。

## 4. ファイル読み込み統合テスト
レシピシステムは、実際のJSONファイルからレシピを読み込む統合テストを提供しています。

### 4.1 テストファイルの配置
- **場所**: `src/test/resources/recipes` ディレクトリ
- **形式**: テスト用に構造化された 5 つのグループ（基本、魔法、複雑I/O、論理、継承）
- **テスト実行**: クラスパス上のリソースとして読み込み

### 4.2 JSONLoaderIntegrationTest
- 20種類のテストケースでレシピシステムを網羅的に検証
  - **I/O タイプ**: Item, Fluid, Energy, Mana, Gas, Essentia, Vis
  - **詳細検証**: OreDict サポート、メタデータ (Damage値)、perTick フラグ
  - **高度な機能**: 
    - **継承システム**: `parent` フィールドによる親レシピからのプロパティ継承とマージ。
    - **抽象レシピ**: `abstract: true` 設定によるテンプレート化（直接読み込まれないことの検証）。
    - **優先度**: `priority` フィールドによるレシピの競合解決。
- **テスト網羅性**: 以前の Ignore（検証待ち）を全て解消し、パース結果の詳細までアサーションを追加済み。
- **ファイル**: `src/test/java/.../recipe/integration/JSONLoaderIntegrationTest.java`
