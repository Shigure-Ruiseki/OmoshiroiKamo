# 構造体システム概要 (Structure System Overview)

OmoshiroiKamo の構造体システムは、高い柔軟性、型安全性、およびコアとなるマシンロジックからの分離を目的に設計されています。

## 1. 設計思想

拡張性を確保するため、主に2つのデザインパターンを採用しています。

- **データとロジックの分離 (Visitor パターン)**:
  構造体定義 (`IStructureEntry`) はデータ（形状、マッピング、要件）のみを保持します。バリデーション、レンダリング、ブロック位置の追跡などのロジックは `IStructureVisitor` を介して実装されます。これにより、データ構造を変更することなく、ホログラムプレビューやティアスキャナーなどの新機能を追加できます。

- **動的な拡張性 (Registry パターン)**:
  「要件（アイテムポート、燃料など）」をハードコードする代わりに、`RequirementRegistry` を使用しています。新しいタイプの要件を実行時に登録できるため、Thaumcraft や Mekanism などの他モジュールが独自の構造的ニーズをシームレスに追加できます。

## 2. 主要コンポーネント

- **`IStructureEntry`**: コアとなるデータインターフェース。単一のマルチブロック定義を表します。
- **`StructureJsonReader`**: JSON ファイルを `IStructureEntry` オブジェクトに変換します。デフォルトのマッピングや階層的な定義を処理します。
- **`StructureManager`**: 全てのロードされた構造体を保持し、検索サービスを提供する中央レジストリ。
- **`StructureAgent`**: TileEntity（`TEMachineController` など）が使用するブリッジコンポーネント。特定の構造体インスタンスを管理し、形成状態の追跡や世界（ワールド）との照合を行います。
- **`PortManager`**: 構造体の `requirements` セクションを専門に扱い、現在のマシンが必要な I/O タイプ（ポート）を十分に備えているかをチェックします。

## 3. モジュールとの関係

- **Multiblock モジュール**: 固定された事前定義済みの構造体名を使用します。JSON が欠落している場合のハードコードされたフォールバックを提供することが多いです。
- **Modular モジュール**: 動的にロードされるカスタム構造体を使用します。柔軟性を確保するため、完全に JSON システムに依存しています。

両方のモジュールは同じ基盤 API を共有しており、開発者と Mod パック製作者の両方に一貫した体験を提供します。
